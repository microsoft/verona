# Verona testsuite

Test cases are divided in top-level directories, for each tool they are testing.
For each top-level directory there is a [toplevel].cmake, e.g. `veronac.cmake` is the
settings for the `veronac` directory, which is used to test `veronac`.   The `cmake` file
provides two things:

* A macro to provide the command line arguments given the test file, and the output directory.
* A list of extensions for tests, e.g.  `set(TEST_EXTENSION verona)`. 

For each test, there is an associate golden output directory. For example, the test
```
testsuite/veronac/demo/run-pass/bank1.verona
```
has an associated output directory
```
testsuite/veronac/demo/run-pass/bank1.out/
```
This can contain any files that were generated by the command using the output directory. 
Additionally, the harness can generate `stdout.txt`, `stderr.txt` and `exit_code.txt` for the 
values of the output and error streams, and the exit code of the test.  If the directory does
not exist CMake will emit a warning.  Only files in the directory will checked that the tool
generated the correct files.  For instance, `testsuite/veronac/demo/run-pass/bank1.out/` does
not contain `stdout.txt` as the printed output is non-deterministic.

## Updating tests

The files that exist in the `.out` directories can be automatically updated.  There is a build
target `update-dump` that will automatically update the contents of any `.out` directory.  It
will only update the files that already exist in the directory, so if there is no `stdout.txt`
file, then after calling `update-dump` the file will still not exist.  If you wish to add the file,
create the file, and then run `update-dump`.

There are also targets for individual testsuite directories, to just regenerate the tests in those
directories. For instance, `testsuite/verona-parser` will just update the output in that directory.

##  Adding new tests

The `update-dump` target will also generate new output directories for any test that does not
currently have an output directory.  The output directory will contain all the output files that
the test can generate.  You might not wish to test all the phases with this test. Remove any files
you do not wish to test, and commit the rest.

## To add a new tool

If you need to add a new tool, then you create a new top-level directory with that tools name,
and create the `[toolname].cmake` file to find tests and generate the command line.